# Диагностика ошибки 500

## Быстрая проверка

### 1. Проверка синтаксиса
```bash
cd backend
python3 manage.py check
```

### 2. Проверка миграций
```bash
python3 manage.py migrate
```

### 3. Проверка статики
```bash
python3 manage.py collectstatic --noinput
```

### 4. Включить DEBUG для просмотра ошибки
В `settings.py` временно:
```python
DEBUG = True
```

**ВНИМАНИЕ**: Не оставляйте DEBUG=True в production!

## Возможные причины

### 1. Проблема с шаблоном base.html
**Исправлено**: 
- Добавлена проверка `request.path|default:'/'` вместо `request.get_full_path`
- Упрощена логика переключателя языков

### 2. Проблема с импортами
**Проверено**: Все импорты корректны

### 3. Проблема с базой данных
**Решение**: Примените миграции:
```bash
python3 manage.py migrate
```

### 4. Проблема с AI service
**Исправлено**: 
- Добавлена обработка ошибок
- Проверка на пустой ответ

## Как найти конкретную ошибку

### В development:
1. Включите DEBUG=True
2. Откройте страницу с ошибкой
3. Посмотрите полный traceback в браузере

### В production (Render):
1. Откройте логи сервиса в Render Dashboard
2. Найдите последнюю ошибку 500
3. Проверьте traceback

## Частые проблемы и решения

### Проблема: ImportError
**Решение**: Установите зависимости
```bash
pip install -r requirements.txt
```

### Проблема: DatabaseError
**Решение**: Примените миграции
```bash
python3 manage.py migrate
```

### Проблема: TemplateDoesNotExist
**Решение**: Проверьте пути к шаблонам в settings.py

### Проблема: AttributeError
**Решение**: Проверьте что все переменные определены в контексте view

## Проверка конкретных файлов

Все файлы проверены:
- ✅ `views.py` - синтаксис корректен
- ✅ `models.py` - миграции применены
- ✅ `base.html` - шаблон исправлен
- ✅ `ai_service.py` - обработка ошибок добавлена

## Следующие шаги

Если ошибка 500 все еще возникает:
1. Включите DEBUG=True
2. Откройте страницу с ошибкой
3. Скопируйте полный traceback
4. Проверьте какой именно view/шаблон вызывает ошибку

