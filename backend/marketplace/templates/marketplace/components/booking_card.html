{% load i18n %}

<div
    class="bg-white dark:bg-slate-700 rounded-xl p-6 shadow-sm border border-slate-200 dark:border-slate-600 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
    <div class="flex-1">
        <div class="flex items-center gap-3 mb-2">
            <span class="px-2.5 py-0.5 rounded-full text-xs font-medium
                {% if booking.status == 'PENDING' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300
                {% elif booking.status == 'CONFIRMED' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300
                {% elif booking.status == 'COMPLETED' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300
                {% elif booking.status == 'CANCELLED' %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300
                {% endif %}">
                {{ booking.get_status_display }}
            </span>
            <span class="text-slate-500 dark:text-slate-400 text-sm">
                <i class="far fa-clock mr-1"></i> {{ booking.scheduled_date|date:"d E Y" }} в {{
                booking.scheduled_time|time:"H:i" }}
            </span>
        </div>

        <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-1">
            {% if booking.task %}
            <a href="{% url 'marketplace:task_detail' booking.task.id %}" class="hover:text-indigo-600 transition">{{
                booking.task.title }}</a>
            {% else %}
            {% trans "Задача не указана" %}
            {% endif %}
        </h3>

        <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
            {% if is_specialist %}
            <span>{% trans "Клиент:" %} <strong>{{ booking.client.get_full_name|default:booking.client.username
                    }}</strong></span>
            {% else %}
            <span>{% trans "Специалист:" %} <strong>{{
                    booking.specialist.get_full_name|default:booking.specialist.username }}</strong></span>
            {% endif %}
        </div>

        {% if booking.notes %}
        <div class="mt-3 text-sm text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
            <i class="far fa-comment-alt mr-1"></i> {{ booking.notes }}
        </div>
        {% endif %}
    </div>

    <div class="flex gap-2 w-full md:w-auto">
        {% if is_specialist %}
        {% if booking.status == 'PENDING' %}
        <form action="{% url 'marketplace:update_booking_status' booking.id %}" method="post" class="inline">
            {% csrf_token %}
            <input type="hidden" name="action" value="confirm">
            <button type="submit"
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition">
                {% trans "Подтвердить" %}
            </button>
        </form>
        <form action="{% url 'marketplace:update_booking_status' booking.id %}" method="post" class="inline">
            {% csrf_token %}
            <input type="hidden" name="action" value="reject">
            <button type="submit"
                class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm font-medium transition">
                {% trans "Отклонить" %}
            </button>
        </form>
        {% elif booking.status == 'CONFIRMED' %}
        <form action="{% url 'marketplace:update_booking_status' booking.id %}" method="post" class="inline">
            {% csrf_token %}
            <input type="hidden" name="action" value="complete">
            <button type="submit"
                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition">
                {% trans "Завершить" %}
            </button>
        </form>
        {% endif %}
        {% endif %}

        {% if booking.status == 'PENDING' or booking.status == 'CONFIRMED' %}
        <form action="{% url 'marketplace:update_booking_status' booking.id %}" method="post" class="inline">
            {% csrf_token %}
            <input type="hidden" name="action" value="cancel">
            <button type="submit"
                class="px-4 py-2 border border-slate-300 hover:bg-slate-50 text-slate-700 dark:border-slate-600 dark:text-slate-300 dark:hover:bg-slate-600 rounded-lg text-sm font-medium transition">
                {% trans "Отменить" %}
            </button>
        </form>
        {% endif %}
    </div>
</div>