{% load static i18n %}

{# Reusable task card component #}
{# Usage: {% include 'marketplace/components/task_card.html' with task=task view_mode='grid' %} #}

{% if view_mode == 'list' %}
{# List View - Horizontal Layout #}
<div
    class="task-card bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-xl hover:border-indigo-200 transition-all duration-300 overflow-hidden group dark:bg-slate-800 dark:border-slate-700 dark:hover:border-indigo-700">
    <a href="{% url 'marketplace:task_detail' task.id %}" class="flex flex-col md:flex-row no-underline">
        {# Left Section - Main Info #}
        <div class="flex-grow p-6">
            {# Header with Category and Location #}
            <div class="flex flex-wrap items-center gap-3 mb-3">
                <span
                    class="bg-indigo-50 text-indigo-600 text-xs font-bold px-3 py-1.5 rounded-lg uppercase tracking-wide dark:bg-indigo-900/30 dark:text-indigo-300">
                    {{ task.category.name }}
                </span>
                <span class="text-slate-400 text-sm flex items-center gap-1 dark:text-slate-500">
                    <i class="bi bi-geo-alt"></i> {{ task.city }}
                </span>
                {% if task.is_urgent %}
                <span
                    class="bg-red-50 text-red-600 text-xs font-bold px-2 py-1 rounded-lg dark:bg-red-900/30 dark:text-red-300">
                    <i class="bi bi-exclamation-circle"></i> Срочно
                </span>
                {% endif %}
            </div>

            {# Title #}
            <h3
                class="text-xl font-bold text-slate-900 mb-2 group-hover:text-indigo-600 transition-colors dark:text-white dark:group-hover:text-indigo-400">
                {{ task.title }}
            </h3>

            {# Description #}
            <p class="text-slate-600 text-sm mb-4 line-clamp-2 dark:text-slate-300">
                {{ task.description|truncatewords:30 }}
            </p>

            {# Meta Info #}
            <div class="flex flex-wrap gap-4 text-xs text-slate-500 dark:text-slate-400">
                <span class="flex items-center gap-1">
                    <i class="bi bi-clock"></i> {{ task.created_at|timesince }} назад
                </span>
                {% if task.preferred_date %}
                <span class="flex items-center gap-1">
                    <i class="bi bi-calendar3"></i> {{ task.preferred_date|date:"d.m.Y" }}
                </span>
                {% endif %}
                <span class="flex items-center gap-1">
                    <i class="bi bi-chat-dots"></i> {{ task.offers_count }} откликов
                </span>
            </div>
        </div>

        {# Right Section - Budget and Action #}
        <div
            class="border-t md:border-t-0 md:border-l border-slate-100 dark:border-slate-700 p-6 md:w-64 flex flex-col justify-between bg-slate-50 dark:bg-slate-800/50">
            <div>
                <p class="text-xs text-slate-500 mb-1 dark:text-slate-400">Бюджет</p>
                <p class="text-2xl font-bold text-slate-900 dark:text-white">
                    {% if task.budget_min and task.budget_max %}
                    {{ task.budget_min|floatformat:0 }}-{{ task.budget_max|floatformat:0 }} ₽
                    {% elif task.budget_min %}
                    от {{ task.budget_min|floatformat:0 }} ₽
                    {% elif task.budget_max %}
                    до {{ task.budget_max|floatformat:0 }} ₽
                    {% else %}
                    Договорная
                    {% endif %}
                </p>
            </div>
            <div
                class="mt-4 flex items-center justify-between text-indigo-600 dark:text-indigo-400 font-semibold group-hover:gap-2 transition-all">
                <span>Подробнее</span>
                <i class="bi bi-arrow-right group-hover:translate-x-1 transition-transform"></i>
            </div>
        </div>
    </a>
</div>

{% else %}
{# Grid View - Vertical Layout (Default) #}
<div
    class="task-card bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col group overflow-hidden dark:bg-slate-800 dark:border-slate-700">
    <a href="{% url 'marketplace:task_detail' task.id %}" class="flex flex-col h-full no-underline">
        <div class="p-6 flex-grow">
            {# Header with Category and Location #}
            <div class="flex justify-between items-start mb-4">
                <span
                    class="bg-indigo-50 text-indigo-600 text-xs font-bold px-2.5 py-1 rounded-lg uppercase tracking-wide dark:bg-indigo-900/30 dark:text-indigo-300">
                    {{ task.category.name }}
                </span>
                <span class="text-slate-400 text-xs flex items-center gap-1 dark:text-slate-500">
                    <i class="bi bi-geo-alt"></i> {{ task.city }}
                </span>
            </div>

            {# Urgent Badge #}
            {% if task.is_urgent %}
            <div class="mb-3">
                <span
                    class="bg-red-50 text-red-600 text-xs font-bold px-2 py-1 rounded-lg dark:bg-red-900/30 dark:text-red-300">
                    <i class="bi bi-exclamation-circle"></i> Срочно
                </span>
            </div>
            {% endif %}

            {# Title #}
            <h3
                class="text-xl font-bold text-slate-900 mb-3 line-clamp-2 group-hover:text-indigo-600 transition-colors dark:text-white dark:group-hover:text-indigo-400">
                {{ task.title }}
            </h3>

            {# Description #}
            <p class="text-slate-600 text-sm mb-4 line-clamp-3 dark:text-slate-300">
                {{ task.description|truncatewords:25 }}
            </p>

            {# Budget #}
            <div class="mb-4">
                <p class="text-xs text-slate-400 mb-1 dark:text-slate-500">Бюджет</p>
                <p class="text-lg font-bold text-slate-900 dark:text-white">
                    {% if task.budget_min and task.budget_max %}
                    {{ task.budget_min|floatformat:0 }}-{{ task.budget_max|floatformat:0 }} ₽
                    {% elif task.budget_min %}
                    от {{ task.budget_min|floatformat:0 }} ₽
                    {% elif task.budget_max %}
                    до {{ task.budget_max|floatformat:0 }} ₽
                    {% else %}
                    Договорная
                    {% endif %}
                </p>
            </div>

            {# Meta Info #}
            <div
                class="flex flex-wrap gap-3 text-xs text-slate-500 border-t border-slate-100 pt-4 mt-auto dark:text-slate-400 dark:border-slate-700">
                <span class="flex items-center gap-1">
                    <i class="bi bi-clock"></i> {{ task.created_at|timesince }} назад
                </span>
                {% if task.preferred_date %}
                <span class="flex items-center gap-1">
                    <i class="bi bi-calendar3"></i> {{ task.preferred_date|date:"d.m.Y" %}
                </span>
                {% endif %}
                <span class="flex items-center gap-1">
                    <i class="bi bi-chat-dots"></i> {{ task.offers_count }}
                </span>
            </div>
        </div>

        {# Footer #}
        <div
            class="p-4 bg-slate-50 dark:bg-slate-700/50 flex justify-between items-center group-hover:bg-indigo-50 dark:group-hover:bg-indigo-900/20 transition-colors">
            <span class="text-sm text-slate-600 dark:text-slate-300">Посмотреть детали</span>
            <div
                class="p-2 bg-white border border-slate-200 rounded-full text-indigo-600 group-hover:bg-indigo-600 group-hover:text-white group-hover:scale-110 transition-all dark:bg-slate-700 dark:border-slate-600 dark:text-indigo-400 dark:group-hover:bg-indigo-500 dark:group-hover:text-white">
                <i class="bi bi-arrow-right"></i>
            </div>
        </div>
    </a>
</div>
{% endif %}